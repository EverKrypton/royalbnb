<!DOCTYPE html>
<html>

<head>
    <title>Lottery Contract UI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-image: linear-gradient(to right top, #1c1b1c, #1b1a1c, #1b1a1b, #1a191b, #19191b, #212932, #1e3b49, #0e4f5a, #007d78, #2fac7e, #8bd870, #f5fb5f);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        
        h1 {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }
        
        .container {
            max-width: 500px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }
        
        .input-group {
            margin-bottom: 10px;
        }
        
        .button {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            border-radius: 5px;
            background-color: green;
        }
        
        .counter {
            font-size: 24px;
            text-align: center;
        }
        
        #roundInfo,
        #actions {
            margin-bottom: 20px;
        }
        
        #roundInfo h3,
        #actions h3 {
            margin-top: 0;
        }
    </style>


</head>

<body>
    <div class="container">
        <h1>Lottery Contract UI</h1>
        <div id="roundInfo">
            <h3>Current Round Information</h3>
            <p>Round ID: <span id="roundId"></span></p>
            <p>Total Tickets Sold: <span id="totalTicketsSold"></span></p>
            <p>Jackpot: <span id="jackpot"></span> BNB</p>
        </div>
        <div id="actions">
            <h3>Actions</h3>
            <div class="input-group">
                <label for="numTickets">Number of Tickets:</label>
                <input type="number" id="numTickets" min="1" max="10" value="1">
            </div>
            <button onclick="buyTickets()">Buy Tickets</button>
            <button onclick="claimWinnings()">Claim Winnings</button>
            <button onclick="withdrawFunds()">Withdraw Funds</button>
        </div>
        <div id="message"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.5.3/web3.min.js"></script>
    <script>
        // Contract address and ABI
        const contractAddress = '0xcDb266e4b2c08E01eac840DcB25237A2af949549';
        const contractABI = [
            [{
                "inputs": [],
                "name": "addToJackpot",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "numTickets",
                    "type": "uint256"
                }],
                "name": "buyTickets",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            }, {
                "inputs": [],
                "name": "claimWinnings",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [],
                "stateMutability": "nonpayable",
                "type": "constructor"
            }, {
                "anonymous": false,
                "inputs": [{
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "roundId",
                    "type": "uint256"
                }, {
                    "indexed": false,
                    "internalType": "uint256",
                    "name": "startTime",
                    "type": "uint256"
                }],
                "name": "DrawStarted",
                "type": "event"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "interval",
                    "type": "uint256"
                }],
                "name": "setDrawInterval",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "interval",
                    "type": "uint256"
                }],
                "name": "setLotteryTimeInterval",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "maxTickets",
                    "type": "uint256"
                }],
                "name": "setMaxTicketsPerPerson",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "maxTickets",
                    "type": "uint256"
                }],
                "name": "setMaxTicketsPerRound",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "uint256",
                    "name": "price",
                    "type": "uint256"
                }],
                "name": "setTicketPrice",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [],
                "name": "startDraw",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [{
                    "internalType": "address",
                    "name": "newOwner",
                    "type": "address"
                }],
                "name": "transferOwnership",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [],
                "name": "withdrawFunds",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }, {
                "inputs": [],
                "name": "canStartNewLottery",
                "outputs": [{
                    "internalType": "bool",
                    "name": "",
                    "type": "bool"
                }],
                "stateMutability": "view",
                "type": "function"
            }, {
                "inputs": [],
                "name": "MAX_TICKETS_PER_PERSON",
                "outputs": [{
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }],
                "stateMutability": "view",
                "type": "function"
            }, {
                "inputs": [],
                "name": "MAX_TICKETS_PER_ROUND",
                "outputs": [{
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }],
                "stateMutability": "view",
                "type": "function"
            }, {
                "inputs": [],
                "name": "TICKET_PRICE",
                "outputs": [{
                    "internalType": "uint256",
                    "name": "",
                    "type": "uint256"
                }],
                "stateMutability": "view",
                "type": "function"
            }]
        ];

        // Initialize web3
        window.addEventListener('load', async() => {
            if (window.ethereum) {
                window.web3 = new Web3(window.ethereum);
                await window.ethereum.enable();
                initContract();
            } else {
                alert('Please install MetaMask to use this application.');
            }
        });

        // Initialize the contract
        function initContract() {
            const contract = new web3.eth.Contract(contractABI, contractAddress);
            getRoundInfo(contract);
        }

        // Get the current round information from the contract
        function getRoundInfo(contract) {
            contract.methods.roundId().call()
                .then((roundId) => {
                    document.getElementById('roundId').textContent = roundId;
                    return contract.methods.totalTicketsSold().call();
                })
                .then((totalTicketsSold) => {
                    document.getElementById('totalTicketsSold').textContent = totalTicketsSold;
                    return contract.methods.jackpot().call();
                })
                .then((jackpot) => {
                    document.getElementById('jackpot').textContent = web3.utils.fromWei(jackpot, 'ether');
                })
                .catch((error) => {
                    console.error(error);
                });
        }

        // Buy tickets
        function buyTickets() {
            const numTickets = parseInt(document.getElementById('numTickets').value);

            web3.eth.getAccounts((error, accounts) => {
                if (error) {
                    console.error(error);
                } else {
                    const account = accounts[0];
                    const contract = new web3.eth.Contract(contractABI, contractAddress, {
                        from: account
                    });
                    const ticketPriceWei = web3.utils.toWei(TICKET_PRICE.toString(), 'ether');

                    contract.methods.buyTickets(numTickets)
                        .send({
                            value: ticketPriceWei
                        })
                        .on('transactionHash', (hash) => {
                            showMessage('Transaction submitted. Hash: ' + hash);
                        })
                        .on('receipt', (receipt) => {
                            showMessage('Tickets bought successfully.');
                            getRoundInfo(contract);
                        })
                        .on('error', (error) => {
                            console.error(error);
                            showMessage('Error buying tickets. Please try again.');
                        });
                }
            });
        }

        // Claim winnings
        function claimWinnings() {
            web3.eth.getAccounts((error, accounts) => {
                if (error) {
                    console.error(error);
                } else {
                    const account = accounts[0];
                    const contract = new web3.eth.Contract(contractABI, contractAddress, {
                        from: account
                    });

                    contract.methods.claimWinnings()
                        .send()
                        .on('transactionHash', (hash) => {
                            showMessage('Transaction submitted. Hash: ' + hash);
                        })
                        .on('receipt', (receipt) => {
                            showMessage('Winnings claimed successfully.');
                            getRoundInfo(contract);
                        })
                        .on('error', (error) => {
                            console.error(error);
                            showMessage('Error claiming winnings. Please try again.');
                        });
                }
            });
        }

        // Withdraw funds
        function withdrawFunds() {
            web3.eth.getAccounts((error, accounts) => {
                if (error) {
                    console.error(error);
                } else {
                    const account = accounts[0];
                    const contract = new web3.eth.Contract(contractABI, contractAddress, {
                        from: account
                    });

                    contract.methods.withdrawFunds()
                        .send()
                        .on('transactionHash', (hash) => {
                            showMessage('Transaction submitted. Hash: ' + hash);
                        })
                        .on('receipt', (receipt) => {
                            showMessage('Funds withdrawn successfully.');
                            getRoundInfo(contract);
                        })
                        .on('error', (error) => {
                            console.error(error);
                            showMessage('Error withdrawing funds. Please try again.');
                        });
                }
            });
        }

        // Show a message on the UI
        function showMessage(message) {
            const messageElement = document.getElementById('message');
            messageElement.textContent = message;
            messageElement.style.display = 'block';
            setTimeout(() => {
                messageElement.textContent = '';
                messageElement.style.display = 'none';
            }, 5000);
        }
    </script>
</body>

</html>